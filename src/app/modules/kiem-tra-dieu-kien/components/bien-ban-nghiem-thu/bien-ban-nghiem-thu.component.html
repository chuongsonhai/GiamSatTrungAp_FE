<ng-container *ngIf="isLoadingForm$ | async; else showData">
  <div class="overlay-layer bg-transparent">
    <div class="spinner spinner-lg spinner-success">
      <span style="padding-left:35px;">Đang tải dữ liệu, vui lòng chờ</span>
    </div>
  </div>
</ng-container>

<ng-template #showData>
  <form class="form form-label-right">
    <div class="pb-5">
      <div class="row">
        <!-- Cột bên trái: Thông tin yêu cầu -->
        <div class="col-lg-3">
          <div class="form-group">
            <label>{{ congVanYeuCau?.DuAnDien }}</label>
          </div>
          <div class="form-group">
            <label>Người yêu cầu: {{ congVanYeuCau?.NguoiYeuCau }}</label>
          </div>
          <div class="form-group">
            <label>Mã yêu cầu: {{ congVanYeuCau?.MaYeuCau }}</label>
          </div>
          <div class="aside-menu">
            <ul class="nav menu-nav tabs">
              <li class="nav-item" *ngFor="let tab of [
                { id: tabs.ThoaThuanDauNoi, name: 'Thỏa thuận đấu nối' },
                { id: tabs.PhuLucHopDong, name: 'Phụ lục hợp đồng' },
                { id: tabs.HopDongMuaBan, name: 'Hợp đồng mua bán điện' },
                { id: tabs.PhanCongThiCong, name: 'Phân công thi công' },
                { id: tabs.BienBanTreoThao, name: 'Biên bản treo tháo' },
                { id: tabs.BienBanNghiemThu, name: 'Biên bản nghiệm thu' },
                { id: tabs.TaiLieuNghiemThu, name: 'Hồ sơ nghiệm thu' }
              ]"
              (click)="changeTab(tab.id)"
              [class.active]="activeTabId === tab.id">
                <a class="nav-link" data-toggle="tab" role="button"
                  [attr.aria-selected]="activeTabId === tab.id"
                  [class.active]="activeTabId === tab.id">
                  <span class="menu-text">{{ tab.name }}</span>
                </a>
              </li>
            </ul>
          </div>
        </div>

        <!-- Cột bên phải: Nội dung tab -->
        <div class="col-lg-9" style="border: 1px #eee solid;">
          <!-- Thỏa thuận đấu nối -->
          <ng-container *ngIf="activeTabId === tabs.ThoaThuanDauNoi && srcTTDN">
            <div class="pdf-container">
              <iframe class="iframe-pdf"
                [src]="srcTTDN"
                width="100%"
                height="600px"
                frameBorder="0"
                type="application/pdf"
                sandbox="allow-same-origin allow-scripts allow-popups allow-forms">
              </iframe>
            </div>
          </ng-container>

          <!-- Phân công thi công -->
          <ng-container *ngIf="activeTabId === tabs.PhanCongThiCong && congVanYeuCau">
            <app-phan-cong-thi-cong [congVanYeuCau]="congVanYeuCau"></app-phan-cong-thi-cong>
          </ng-container>

          <!-- Biên bản treo tháo -->
          <ng-container *ngIf="activeTabId === tabs.BienBanTreoThao && congVanYeuCau">
            <app-bb-treo-thao [congVanYeuCau]="congVanYeuCau"></app-bb-treo-thao>
          </ng-container>

          <!-- Hồ sơ nghiệm thu -->
          <ng-container *ngIf="activeTabId === tabs.TaiLieuNghiemThu && congVanYeuCau">
            <app-tai-lieu-nghiem-thu [congVanYeuCau]="congVanYeuCau"></app-tai-lieu-nghiem-thu>
          </ng-container>

          <!-- Phụ lục hợp đồng -->
          <ng-container *ngIf="activeTabId === tabs.PhuLucHopDong && congVanYeuCau">
            <app-phu-luc-hop-dong [congVanYeuCau]="congVanYeuCau"></app-phu-luc-hop-dong>
          </ng-container>

          <!-- Biên bản nghiệm thu -->
          <ng-container *ngIf="activeTabId === tabs.BienBanNghiemThu && src">
            <div class="pdf-container">
              <iframe class="iframe-pdf"
                [src]="src"
                width="100%"
                height="600px"
                frameBorder="0"
                type="application/pdf"
                sandbox="allow-same-origin allow-scripts allow-popups allow-forms">
              </iframe>
            </div>
          </ng-container>

          <!-- Hợp đồng mua bán -->
          <ng-container *ngIf="activeTabId === tabs.HopDongMuaBan && congVanYeuCau">
            <app-hop-dong-dien [congVanYeuCau]="congVanYeuCau"></app-hop-dong-dien>
          </ng-container>
        </div>

        <!-- Nút xử lý biên bản -->
        <div class="col-lg-12 text-right" *ngIf="activeTabId === tabs.BienBanNghiemThu && congVanYeuCau">
          <button type="button"
            *ngIf="BienBanNT?.TrangThai === 0"
            (click)="create()"
            class="btn btn-primary mr-2">
            <i class="fa fa-upload"></i> Upload biên bản
          </button>
          <button type="button"
            *ngIf="BienBanNT?.TrangThai === 0 && BienBanNT?.ID > 0"
            (click)="approve()"
            class="btn btn-success mr-2">
            <i class="fa fa-check"></i> Xác nhận
          </button>
        </div>
      </div>
    </div>
  </form>
</ng-template>
